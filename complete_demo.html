<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Status System - Complete Demo</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #0b141a;
            color: #e9edef;
            display: flex;
            flex-direction: column;
            height: 100vh;
            box-sizing: border-box;
        }

        /* --- Selection Screen --- */
        #initial-user-selection {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            height: 100%;
            width: 100%;
        }

        .user-buttons button {
            margin: 10px;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            background-color: #2a3942;
            color: #e9edef;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.2s;
            position: relative;
        }

        .user-buttons button:hover:not(:disabled) {
            background-color: #384e5a;
        }

        .user-buttons button:disabled {
            background-color: #1f2c33;
            color: #8696a0;
            cursor: not-allowed;
        }

        .user-status-badge {
            font-size: 0.8em;
            color: #8696a0;
            display: block;
            margin-top: 5px;
        }

        /* --- Chat Container --- */
        #chat-container {
            display: none;
            flex-direction: column;
            height: 100vh;
            width: 100%;
            box-sizing: border-box;
        }

        /* --- Header Bar --- */
        #header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background-color: #202c33;
            color: #e9edef;
            position: fixed;
            top: 0;
            width: 100%;
            box-sizing: border-box;
            z-index: 10;
        }

        #user-info-left {
            display: flex;
            align-items: center;
        }

        #user-info-right {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 2px;
        }

        .user-id {
            font-weight: bold;
            color: #00a884;
            font-size: 1.1em;
        }

        .other-user-label {
            font-weight: 600;
            color: #e9edef;
            font-size: 1.0em;
        }

        .status-online {
            color: #00a884;
            font-weight: normal;
            font-size: 0.9em;
        }

        .status-offline {
            color: #8696a0;
            font-weight: normal;
            font-size: 0.9em;
        }

        /* --- Messages Container --- */
        #messages {
            list-style-type: none;
            margin: 80px 0 80px 0;
            padding: 20px;
            overflow-y: auto;
            width: 100%;
            box-sizing: border-box;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: stretch;
        }

        .message-bubble {
            display: inline-flex;
            flex-direction: column;
            width: fit-content;
            max-width: 65%;
            margin-bottom: 12px;
            padding: 8px 10px;
            border-radius: 10px;
            position: relative;
            word-wrap: break-word;
            box-shadow: 0 1px 0.5px rgba(0, 0, 0, 0.13);
        }

        .my-message {
            background-color: #005c4b;
            align-self: flex-end;
            margin-left: auto;
        }

        .their-message {
            background-color: #202c33;
            align-self: flex-start;
            margin-right: auto;
        }

        .message-time {
            font-size: 0.7em;
            color: rgba(255, 255, 255, 0.6);
            align-self: flex-end;
            margin-top: 3px;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* --- Input Form --- */
        #form {
            display: flex;
            align-items: flex-end;
            padding: 8px 10px;
            background-color: #1f2c33;
            position: fixed;
            bottom: 0;
            width: 100%;
            box-sizing: border-box;
            z-index: 10;
        }

        #input {
            flex-grow: 1;
            min-height: 40px;
            max-height: 120px;
            padding: 10px 15px;
            margin: 0 8px;
            border: none;
            border-radius: 20px;
            background-color: #2a3942;
            color: #e9edef;
            resize: none;
            overflow-y: auto;
            font-size: 1em;
            box-sizing: border-box;
        }

        #send-button {
            flex-shrink: 0;
            width: 44px;
            height: 44px;
            padding: 0;
            margin: 0 3px;
            border: none;
            border-radius: 50%;
            background-color: #00a884;
            color: white;
            cursor: pointer;
        }

        .demo-info {
            background-color: #1f2c33;
            padding: 15px;
            margin: 10px;
            border-radius: 8px;
            border-left: 4px solid #00a884;
        }
    </style>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>

    <div id="initial-user-selection">
        <h1>Who are you chatting as?</h1>
        <div class="user-buttons">
            <button data-user="i" onclick="selectUser('i')">
                Chat as: i
                <span class="user-status-badge" id="status-i">offline</span>
            </button>
            <button data-user="x" onclick="selectUser('x')">
                Chat as: x
                <span class="user-status-badge" id="status-x">offline</span>
            </button>
        </div>
        <p>(Select a user to begin chat simulation)</p>
        
        <div class="demo-info">
            <strong>ðŸš€ Enhanced User Status System Demo</strong><br>
            This demo showcases the enhanced presence system with:<br>
            â€¢ Online/Offline status indicators<br>
            â€¢ Precise time formatting (just now, X minutes ago, etc.)<br>
            â€¢ Real-time status updates<br>
            â€¢ Right-side user status display in chat header
        </div>
    </div>

    <div id="chat-container">
        
        <div id="header-bar">
            <div id="user-info-left">
                <span id="my-user-id-display" class="user-id"></span>
            </div>
            <div id="user-info-right">
                <span id="other-user-name" class="other-user-label"></span>
                <span id="other-user-status" class="status-offline"></span>
            </div>
        </div>
        
        <ul id="messages"></ul>

        <form id="form" action="">
            <textarea id="input" autocomplete="off" placeholder="Type a message..." rows="1"></textarea>
            <button id="send-button" type="submit">Send</button>
        </form>

    </div>

    <script>
        // Simulated user presence system
        let currentUser = null;
        let simulatedPresence = {
            'i': { 
                isOnline: false, 
                lastSeen: new Date(Date.now() - 120000).toISOString() // 2 minutes ago
            },
            'x': { 
                isOnline: false, 
                lastSeen: new Date(Date.now() - 3600000).toISOString() // 1 hour ago
            }
        };

        // Mock messages
        const mockMessages = [
            { senderID: 'i', message: 'Hello there!', type: 'text', timestamp: new Date(Date.now() - 7200000).toISOString() },
            { senderID: 'x', message: 'Hi! How are you?', type: 'text', timestamp: new Date(Date.now() - 6000000).toISOString() },
            { senderID: 'i', message: 'I am good! Thanks for asking.', type: 'text', timestamp: new Date(Date.now() - 3000000).toISOString() }
        ];

        function getTimeAgo(timestamp) {
            if (!timestamp) return null;
            
            const now = new Date();
            const past = new Date(timestamp);
            const diffMs = now - past;
            const diffSeconds = Math.floor(diffMs / 1000);
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffSeconds < 30) return 'just now';
            if (diffSeconds < 60) return 'less than a minute ago';
            if (diffMins < 60) return `${diffMins} minute${diffMins > 1 ? 's' : ''} ago`;
            if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
            return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
        }

        function updateUserStatusButtons() {
            for (const userId in simulatedPresence) {
                const statusBadge = document.getElementById(`status-${userId}`);
                const user = simulatedPresence[userId];
                
                if (user.isOnline) {
                    statusBadge.textContent = 'online';
                    statusBadge.style.color = '#00a884';
                } else {
                    statusBadge.textContent = `last seen ${getTimeAgo(user.lastSeen)}`;
                    statusBadge.style.color = '#8696a0';
                }
            }
        }

        function selectUser(userId) {
            currentUser = userId;
            
            // Simulate user coming online
            simulatedPresence[userId].isOnline = true;
            simulatedPresence[userId].lastSeen = new Date().toISOString();
            
            // Show chat interface
            document.getElementById('initial-user-selection').style.display = 'none';
            document.getElementById('chat-container').style.display = 'flex';
            document.getElementById('my-user-id-display').textContent = 'USER ' + userId.toUpperCase();
            
            // Set other user info
            const otherUser = userId === 'i' ? 'x' : 'i';
            document.getElementById('other-user-name').textContent = 'USER ' + otherUser.toUpperCase();
            
            // Update other user status
            updateOtherUserStatus();
            
            // Load mock messages
            loadMessages();
            
            // Start status updates
            startStatusSimulation();
        }

        function updateOtherUserStatus() {
            if (!currentUser) return;
            
            const otherUser = currentUser === 'i' ? 'x' : 'i';
            const otherPresence = simulatedPresence[otherUser];
            const statusElement = document.getElementById('other-user-status');
            
            if (otherPresence.isOnline) {
                statusElement.textContent = 'Online';
                statusElement.className = 'status-online';
            } else {
                statusElement.textContent = `last seen ${getTimeAgo(otherPresence.lastSeen)}`;
                statusElement.className = 'status-offline';
            }
        }

        function loadMessages() {
            const messagesContainer = document.getElementById('messages');
            messagesContainer.innerHTML = '';
            
            mockMessages.forEach(msg => {
                const isMyMessage = msg.senderID === currentUser;
                const li = document.createElement('li');
                li.className = `message-bubble ${isMyMessage ? 'my-message' : 'their-message'}`;
                
                const contentDiv = document.createElement('div');
                contentDiv.className = 'message-content';
                contentDiv.textContent = msg.message;
                
                const timeSpan = document.createElement('span');
                timeSpan.className = 'message-time';
                timeSpan.textContent = new Date(msg.timestamp).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                
                li.appendChild(contentDiv);
                li.appendChild(timeSpan);
                messagesContainer.appendChild(li);
            });
        }

        function startStatusSimulation() {
            // Update other user status every 5 seconds for demo
            setInterval(() => {
                const otherUser = currentUser === 'i' ? 'x' : 'i';
                
                // Simulate status changes
                if (Math.random() > 0.7) {
                    simulatedPresence[otherUser].isOnline = !simulatedPresence[otherUser].isOnline;
                    simulatedPresence[otherUser].lastSeen = new Date().toISOString();
                } else if (!simulatedPresence[otherUser].isOnline) {
                    // Update last seen time for offline user
                    simulatedPresence[otherUser].lastSeen = new Date(Date.now() - Math.random() * 7200000).toISOString();
                }
                
                updateOtherUserStatus();
                updateUserStatusButtons();
            }, 5000);
        }

        // Handle form submission
        document.getElementById('form').addEventListener('submit', (e) => {
            e.preventDefault();
            const input = document.getElementById('input');
            if (input.value.trim()) {
                const li = document.createElement('li');
                li.className = 'message-bubble my-message';
                
                const contentDiv = document.createElement('div');
                contentDiv.className = 'message-content';
                contentDiv.textContent = input.value;
                
                const timeSpan = document.createElement('span');
                timeSpan.className = 'message-time';
                timeSpan.textContent = new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                
                li.appendChild(contentDiv);
                li.appendChild(timeSpan);
                document.getElementById('messages').appendChild(li);
                
                input.value = '';
                
                // Scroll to bottom
                const messages = document.getElementById('messages');
                messages.scrollTop = messages.scrollHeight;
            }
        });

        // Initialize status buttons
        updateUserStatusButtons();
    </script>
</body>
</html>